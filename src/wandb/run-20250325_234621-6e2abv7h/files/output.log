Generating frontier for markets:   0%|                                                            | 0/99 [00:00<?, ?it/s]/common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py:80: FutureWarning: The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.
  quote_price = pd.Series(index=original_opt_buy_book.index)
There are 27 buy orders and 23 sell orders
#####Generating combinatorial/book/STOCK_2_SEED_2_book_GS_MSFT.npy with size 50 and noise 0.0625#####
Starting async computation for iteration 1
Set parameter Username
Academic license - for non-commercial use only - expires 2025-11-08
Int64Index([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,
            17, 18, 19, 20, 21, 22, 23, 24, 25, 26],
           dtype='int64') {4, 5, 6, 12, 15}
Int64Index([27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43,
            44, 45, 46, 47, 48, 49],
           dtype='int64') {34, 35, 36, 40, 42, 43, 46, 47}
22
15

Checking buy side options:  23%|█████████████▏                                            | 5/22 [00:03<00:10,  1.63it/s]
original bid: 4.58,quoted bid: 4.58
original bid: 0.29,quoted bid: 0.29
original bid: 143.91,quoted bid: 143.90999999999735

Checking buy side options:  41%|███████████████████████▋                                  | 9/22 [00:05<00:07,  1.80it/s]
original bid: 0.12,quoted bid: 0.12

Checking buy side options:  59%|█████████████████████████████████▋                       | 13/22 [00:07<00:04,  2.10it/s]
original bid: 0.51,quoted bid: 0.51
original bid: 28.07,quoted bid: 28.07
original bid: 0.21,quoted bid: 0.0726668520575656


Checking buy side options:  86%|█████████████████████████████████████████████████▏       | 19/22 [00:10<00:01,  1.77it/s]
Checking buy side options: 100%|█████████████████████████████████████████████████████████| 22/22 [00:13<00:00,  1.47it/s]
Checking sell side options:   0%|                                                                 | 0/15 [00:00<?, ?it/s]
original bid: 42.71,quoted bid: 42.71
original ask: 2.38,quoted ask: 2.3800000000046566
order to quote: option1                                    3.00
option2                                   -2.00
C=Call, P=Put                             -1.00
Strike Price of the Option Times 1000    314.00
transaction_type                           0.00
B/A_price                                  2.38
Name: 27, dtype: float64
quote_price: 2.3800000000046566
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  13%|███████▌                                                 | 2/15 [00:14<01:18,  6.06s/it]
order to quote: option1                                    3.00
option2                                   -1.00
C=Call, P=Put                             -1.00
Strike Price of the Option Times 1000    403.50
transaction_type                           0.00
B/A_price                                  0.49
Name: 28, dtype: float64
quote_price: 0.4899999999906868
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()
-> for option_index in tqdm(range(len(opt_sell_book_holder)), desc='Checking sell side options'):
original ask: 0.04,quoted ask: 0.0400000000372529
order to quote: option1                                   1.00
option2                                  -1.00
C=Call, P=Put                            -1.00
Strike Price of the Option Times 1000    28.00
transaction_type                          0.00
B/A_price                                 0.04
Name: 29, dtype: float64
quote_price: 0.0400000000372529
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  20%|███████████▍                                             | 3/15 [01:16<06:19, 31.64s/it]
order to quote: option1                                     8.00
option2                                     9.00
C=Call, P=Put                              -1.00
Strike Price of the Option Times 1000    2134.50
transaction_type                            0.00
B/A_price                                   1.14
Name: 30, dtype: float64
quote_price: 1.121786801959388
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  27%|███████████████▏                                         | 4/15 [01:38<05:08, 28.04s/it]
original ask: 0.04,quoted ask: 0.0400000000372529
order to quote: option1                                    1.00
option2                                    3.00
C=Call, P=Put                             -1.00
Strike Price of the Option Times 1000    364.00
transaction_type                           0.00
B/A_price                                  0.04
Name: 31, dtype: float64
quote_price: 0.0400000000372529
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  33%|███████████████████                                      | 5/15 [01:42<03:14, 19.42s/it]
order to quote: option1                                   -1.0
option2                                    4.0
C=Call, P=Put                              1.0
Strike Price of the Option Times 1000    188.0
transaction_type                           0.0
B/A_price                                 43.7
Name: 32, dtype: float64
quote_price: 43.699999999953434
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  40%|██████████████████████▊                                  | 6/15 [02:11<03:22, 22.50s/it]
order to quote: option1                                     3.00
option2                                     7.00
C=Call, P=Put                               1.00
Strike Price of the Option Times 1000    1221.00
transaction_type                            0.00
B/A_price                                 117.32
Name: 33, dtype: float64
quote_price: 117.31999999994878
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  47%|██████████████████████████▌                              | 7/15 [02:14<02:10, 16.34s/it]
order to quote: option1                                     7.00
option2                                     4.00
C=Call, P=Put                              -1.00
Strike Price of the Option Times 1000    1554.00
transaction_type                            0.00
B/A_price                                   0.94
Name: 37, dtype: float64
quote_price: 0.9399999999441206
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  53%|██████████████████████████████▍                          | 8/15 [02:16<01:21, 11.68s/it]
original ask: 0.95,quoted ask: 0.9500012391945347
order to quote: option1                                     7.00
option2                                     8.00
C=Call, P=Put                              -1.00
Strike Price of the Option Times 1000    1875.00
transaction_type                            0.00
B/A_price                                   0.95
Name: 38, dtype: float64
quote_price: 0.9500012391945347
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  60%|██████████████████████████████████▏                      | 9/15 [02:28<01:10, 11.74s/it]
original ask: 0.13,quoted ask: 0.1300000000046566
order to quote: option1                                     8.00
option2                                     7.00
C=Call, P=Put                              -1.00
Strike Price of the Option Times 1000    1642.50
transaction_type                            0.00
B/A_price                                   0.13
Name: 39, dtype: float64
quote_price: 0.1300000000046566
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  67%|█████████████████████████████████████▎                  | 10/15 [02:32<00:46,  9.28s/it]
order to quote: option1                                    3.00
option2                                    2.00
C=Call, P=Put                             -1.00
Strike Price of the Option Times 1000    713.00
transaction_type                           0.00
B/A_price                                  0.74
Name: 41, dtype: float64
quote_price: 0.7399999999906868
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  80%|████████████████████████████████████████████▊           | 12/15 [02:36<00:16,  5.39s/it]
order to quote: option1                                   1.00
option2                                  -1.00
C=Call, P=Put                            -1.00
Strike Price of the Option Times 1000    68.00
transaction_type                          0.00
B/A_price                                 1.59
Name: 44, dtype: float64
quote_price: 0.9672040302539244
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options:  93%|████████████████████████████████████████████████████▎   | 14/15 [02:38<00:03,  3.18s/it]
original ask: 0.92,quoted ask: 0.9200000000419095
order to quote: option1                                    1.00
option2                                    6.00
C=Call, P=Put                             -1.00
Strike Price of the Option Times 1000    725.00
transaction_type                           0.00
B/A_price                                  0.92
Name: 45, dtype: float64
quote_price: 0.9200000000419095
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()
-> for option_index in tqdm(range(len(opt_sell_book_holder)), desc='Checking sell side options'):
order to quote: option1                                   5.00
option2                                  -8.00
C=Call, P=Put                            -1.00
Strike Price of the Option Times 1000    39.50
transaction_type                          0.00
B/A_price                                 8.37
Name: 48, dtype: float64
quote_price: 8.369999999995343
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()

Checking sell side options: 100%|████████████████████████████████████████████████████████| 15/15 [02:39<00:00,  2.58s/it]
order to quote: option1                                    2.00
option2                                    3.00
C=Call, P=Put                             -1.00
Strike Price of the Option Times 1000    680.50
transaction_type                           0.00
B/A_price                                  4.36
Name: 49, dtype: float64
quote_price: 4.35999999998603
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(262)synthetic_combo_frontier_generation()
-> for option_index in tqdm(range(len(opt_sell_book_holder)), desc='Checking sell side options'):
> /common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py(535)<module>()
-> async_result = pool.apply_async(run_with_timeout, (opt_orders_df, args.offset))
530  	                        # frontier_option_label_attempt_2 = synthetic_combo_frontier_generation(opt_buy_book_new, opt_sell_book_new, opt_l = False, debug=0)
531  	                        # assert frontier_option_label_attempt_2.equals(frontier_option_label_attempt_1_copy)
532  	                        # frontier_option_label = deepcopy(frontier_option_label_attempt_1)
533  	                        result = synthetic_combo_frontier_generation(opt_orders_df, args.offset)
534  	                        breakpoint()
535  ->	                        async_result = pool.apply_async(run_with_timeout, (opt_orders_df, args.offset))
536  	                        # # frontier_option_label = async_result.get(timeout=600)
537  	                        # df = pd.DataFrame(frontier_option_label, columns=['option1', 'option2','C=Call, P=Put',
538  	                        # 'Strike Price of the Option Times 1000',
539  	                        # 'transaction_type', 'B/A_price',
540  	                        # 'belongs_to_frontier'])
    option1  option2  C=Call, P=Put  ...  transaction_type  B/A_price  belongs_to_frontier
0       4.0     -3.0            1.0  ...               1.0     144.83                  0.0
1      -1.0      2.0            1.0  ...               1.0       4.58                  1.0
2       8.0     -3.0           -1.0  ...               1.0       0.29                  1.0
3      -1.0      6.0            1.0  ...               1.0     143.91                  1.0
7       3.0     -1.0            1.0  ...               1.0     157.07                  1.0
8      -1.0      9.0           -1.0  ...               1.0       0.12                  1.0
9       4.0     -5.0            1.0  ...               1.0     115.05                  0.0
10      5.0     -8.0            1.0  ...               1.0      70.60                  0.0
11      5.0     -8.0           -1.0  ...               1.0      31.53                  1.0
13      2.0      1.0           -1.0  ...               1.0       0.51                  1.0
14      5.0     -2.0            1.0  ...               1.0      28.07                  1.0
16     -1.0      4.0           -1.0  ...               1.0       0.21                  1.0
17      3.0     -7.0           -1.0  ...               1.0     186.47                  1.0
18      1.0     -1.0            1.0  ...               1.0      63.75                  0.0
19      5.0      4.0           -1.0  ...               1.0       3.16                  0.0
20      4.0     -3.0           -1.0  ...               1.0     146.28                  0.0
21     -1.0      3.0            1.0  ...               1.0       9.16                  1.0
22      9.0      7.0           -1.0  ...               1.0      62.31                  0.0
23      1.0     -1.0            1.0  ...               1.0      52.57                  0.0
24      8.0     -9.0            1.0  ...               1.0       4.70                  0.0
25      5.0     -7.0           -1.0  ...               1.0     255.48                  0.0
26      7.0     -1.0           -1.0  ...               1.0      42.71                  1.0
27      3.0     -2.0           -1.0  ...               0.0       2.38                  1.0
28      3.0     -1.0           -1.0  ...               0.0       0.49                  0.0
29      1.0     -1.0           -1.0  ...               0.0       0.04                  1.0
30      8.0      9.0           -1.0  ...               0.0       1.14                  0.0
31      1.0      3.0           -1.0  ...               0.0       0.04                  1.0
32     -1.0      4.0            1.0  ...               0.0      43.70                  0.0
33      3.0      7.0            1.0  ...               0.0     117.32                  0.0
37      7.0      4.0           -1.0  ...               0.0       0.94                  0.0
38      7.0      8.0           -1.0  ...               0.0       0.95                  1.0
39      8.0      7.0           -1.0  ...               0.0       0.13                  1.0
41      3.0      2.0           -1.0  ...               0.0       0.74                  0.0
44      1.0     -1.0           -1.0  ...               0.0       1.59                  0.0
45      1.0      6.0           -1.0  ...               0.0       0.92                  1.0
48      5.0     -8.0           -1.0  ...               0.0       8.37                  0.0
49      2.0      3.0           -1.0  ...               0.0       4.36                  0.0
[37 rows x 7 columns]
Generating frontier for markets:   0%|                                                            | 0/99 [03:25<?, ?it/s]
Traceback (most recent call last):
  File "/common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py", line 535, in <module>
    async_result = pool.apply_async(run_with_timeout, (opt_orders_df, args.offset))
  File "/common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py", line 535, in <module>
    async_result = pool.apply_async(run_with_timeout, (opt_orders_df, args.offset))
  File "/common/home/hg343/anaconda3/lib/python3.9/bdb.py", line 88, in trace_dispatch
    return self.dispatch_line(frame)
  File "/common/home/hg343/anaconda3/lib/python3.9/bdb.py", line 112, in dispatch_line
    self.user_line(frame)
  File "/common/home/hg343/anaconda3/lib/python3.9/pdb.py", line 262, in user_line
    self.interaction(frame, None)
  File "/common/home/hg343/anaconda3/lib/python3.9/pdb.py", line 357, in interaction
    self._cmdloop()
  File "/common/home/hg343/anaconda3/lib/python3.9/pdb.py", line 322, in _cmdloop
    self.cmdloop()
  File "/common/home/hg343/anaconda3/lib/python3.9/cmd.py", line 126, in cmdloop
    line = input(self.prompt)
  File "/common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py", line 57, in signal_handler
    pool.terminate()
  File "/common/home/hg343/anaconda3/lib/python3.9/multiprocessing/pool.py", line 654, in terminate
    self._terminate()
  File "/common/home/hg343/anaconda3/lib/python3.9/multiprocessing/util.py", line 224, in __call__
    res = self._callback(*self._args, **self._kwargs)
  File "/common/home/hg343/anaconda3/lib/python3.9/multiprocessing/pool.py", line 692, in _terminate_pool
    cls._help_stuff_finish(inqueue, task_handler, len(pool))
  File "/common/home/hg343/anaconda3/lib/python3.9/multiprocessing/pool.py", line 672, in _help_stuff_finish
    inqueue._rlock.acquire()
  File "/common/home/hg343/Research/accelerate_combo_option/src/combo_stock_frontier_data_preprocessor.py", line 59, in signal_handler
    sys.exit(1)
  File "/common/home/hg343/anaconda3/lib/python3.9/site-packages/wandb/sdk/lib/exit_hooks.py", line 36, in exit
    self._orig_exit(orig_code)  # type: ignore
SystemExit: 1
Ctrl+C received. Terminating processes...